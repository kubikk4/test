<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Змейка — браузерная игра</title>
<style>
  body{font-family:system-ui, sans-serif;background:#111;color:#eee;text-align:center;margin:0;padding:24px}
  #game{border:2px solid #888;background:#000;margin:0 auto;display:block}
  #hud{margin-top:8px;font-size:18px}
  button{margin-top:16px;padding:8px 18px;font-size:16px;border:none;border-radius:6px;
         background:#26a269;color:#fff;cursor:pointer}
  button:disabled{background:#444;cursor:default}
</style>
</head>
<body>
<h1>Змейка</h1>

<canvas id="game" width="400" height="400"></canvas>

<div id="hud">
  Очки: <span id="score">0</span>
</div>

<button id="play-again" style="display:none">Сыграть ещё</button>

<script>
(() => {
  /*--- Константы и переменные ---*/
  const canvas = document.getElementById('game');
  const ctx     = canvas.getContext('2d');
  const size    = 20;          // клетка 20×20 px
  const cells   = canvas.width / size;
  let snake, direction, food, score, running, loopId;

  /*--- Инициализация игры ---*/
  function init() {
    snake      = [{x: 10, y: 10}];  // начальное положение
    direction  = {x: 1, y: 0};      // вправо
    spawnFood();
    score      = 0;
    running    = true;
    document.getElementById('score').textContent = score;
    document.getElementById('play-again').style.display = 'none';

    clearInterval(loopId);
    loopId = setInterval(tick, 120); // скорость
  }

  /*--- Игровой цикл ---*/
  function tick() {
    if (!running) return;
    const head = {
      x: (snake[0].x + direction.x + cells) % cells,
      y: (snake[0].y + direction.y + cells) % cells
    };

    // столкновение с собой
    if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
      endGame();
      return;
    }

    snake.unshift(head);

    // еда
    if (head.x === food.x && head.y === food.y) {
      score++;
      document.getElementById('score').textContent = score;
      spawnFood();
    } else {
      snake.pop();
    }

    draw();
  }

  /*--- Рендер ---*/
  function draw() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // змея
    ctx.fillStyle = '#0f0';
    snake.forEach(({x, y}) => ctx.fillRect(x * size, y * size, size-1, size-1));

    // еда
    ctx.fillStyle = '#f00';
    ctx.fillRect(food.x * size, food.y * size, size-1, size-1);
  }

  /*--- Генерация новой еды ---*/
  function spawnFood() {
    do {
      food = {
        x: Math.floor(Math.random() * cells),
        y: Math.floor(Math.random() * cells)
      };
    } while (snake.some(s => s.x === food.x && s.y === food.y));
  }

  /*--- Завершение игры ---*/
  function endGame() {
    running = false;
    clearInterval(loopId);
    document.getElementById('play-again').style.display = 'inline-block';
  }

  /*--- Управление ---*/
  window.addEventListener('keydown', e => {
    const key = e.key.toLowerCase();
    const dirs = {
      'arrowup':    {x:0, y:-1}, 'w': {x:0, y:-1},
      'arrowdown':  {x:0, y:1},  's': {x:0, y:1},
      'arrowleft':  {x:-1,y:0},  'a': {x:-1,y:0},
      'arrowright': {x:1, y:0},  'd': {x:1, y:0}
    };
    if (dirs[key]) {
      const newDir = dirs[key];
      // запрет разворота на 180°
      if (snake.length > 1 && snake[0].x + newDir.x === snake[1].x && snake[0].y + newDir.y === snake[1].y)
        return;
      direction = newDir;
    }
    if (key === ' ' && !running) init(); // пробел — рестарт
  });

  /*--- Кнопка «Сыграть ещё» ---*/
  document.getElementById('play-again').addEventListener('click', init);

  // запуск
  init();
})();
</script>
</body>
</html>

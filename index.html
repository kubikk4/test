<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Змейка для телефона</title>
<style>
  body {font-family: system-ui, sans-serif; background:#111; color:#eee; text-align:center; margin:0; padding:24px;}
  #game{border:2px solid #888;background:#000;margin:0 auto;display:block}
  #hud{margin-top:8px;font-size:18px}
  #controls{margin-top:12px}
  #controls button{width:60px;height:60px;font-size:32px;margin:4px;border:none;border-radius:6px;background:#555;color:#fff}
  button:active{background:#777}
  #play-again,#start{margin-top:16px;padding:8px 18px;font-size:16px;border:none;border-radius:6px;background:#26a269;color:#fff;cursor:pointer}
  .hidden{display:none}
</style>
</head>
<body>
<h1>Змейка</h1>
<button id="start">Начать игру</button>
<canvas id="game" width="400" height="400" class="hidden"></canvas>
<div id="hud" class="hidden">Очки: <span id="score">0</span></div>
<div id="controls" class="hidden">
  <div>
    <button data-dir="up">&#9650;</button>
  </div>
  <div>
    <button data-dir="left">&#9664;</button>
    <button data-dir="down">&#9660;</button>
    <button data-dir="right">&#9654;</button>
  </div>
</div>
<button id="play-again" class="hidden">Сыграть ещё</button>
<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const size = 20;
  const cells = canvas.width / size;
  let snake, direction, food, score, running = false, loopId;
  const startBtn = document.getElementById('start');
  const playAgainBtn = document.getElementById('play-again');
  const hud = document.getElementById('hud');
  const controls = document.getElementById('controls');

  function init() {
    snake = [{x:10, y:10}];
    direction = {x:1, y:0};
    spawnFood();
    score = 0;
    running = true;
    document.getElementById('score').textContent = score;
    playAgainBtn.classList.add('hidden');
    startBtn.classList.add('hidden');
    canvas.classList.remove('hidden');
    hud.classList.remove('hidden');
    controls.classList.remove('hidden');
    clearInterval(loopId);
    loopId = setInterval(tick, 120);
  }

  function tick() {
    if (!running) return;
    const head = {x:(snake[0].x + direction.x + cells)%cells, y:(snake[0].y + direction.y + cells)%cells};
    if (snake.some(seg => seg.x===head.x && seg.y===head.y)) {
      endGame();
      return;
    }
    snake.unshift(head);
    if (head.x===food.x && head.y===food.y) {
      score++;
      document.getElementById('score').textContent = score;
      spawnFood();
    } else {
      snake.pop();
    }
    draw();
  }

  function draw() {
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#0f0';
    snake.forEach(({x,y}) => ctx.fillRect(x*size, y*size, size-1, size-1));
    ctx.fillStyle = '#f00';
    ctx.fillRect(food.x*size, food.y*size, size-1, size-1);
  }

  function spawnFood() {
    do {
      food = {x:Math.floor(Math.random()*cells), y:Math.floor(Math.random()*cells)};
    } while (snake.some(s => s.x===food.x && s.y===food.y));
  }

  function endGame() {
    running = false;
    clearInterval(loopId);
    playAgainBtn.classList.remove('hidden');
  }

  const dirMap = {
    up:{x:0,y:-1},
    down:{x:0,y:1},
    left:{x:-1,y:0},
    right:{x:1,y:0}
  };

  window.addEventListener('keydown', e => {
    const key = e.key.toLowerCase();
    const mapping = {arrowup:'up', w:'up', arrowdown:'down', s:'down', arrowleft:'left', a:'left', arrowright:'right', d:'right'};
    if (mapping[key]) changeDirection(dirMap[mapping[key]]);
    if (key===' ' && !running) init();
  });

  document.querySelectorAll('#controls button').forEach(btn => {
    const d = dirMap[btn.dataset.dir];
    ['click','touchstart'].forEach(ev => {
      btn.addEventListener(ev, e => {
        e.preventDefault();
        changeDirection(d);
      });
    });
  });

  function changeDirection(newDir) {
    if (snake.length > 1 && snake[0].x + newDir.x === snake[1].x && snake[0].y + newDir.y === snake[1].y) return;
    direction = newDir;
  }

  playAgainBtn.addEventListener('click', init);
  startBtn.addEventListener('click', init);
})();
</script>
</body>
</html>
